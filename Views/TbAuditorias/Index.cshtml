@model IEnumerable<TbAuditorium>

@{
    ViewData["Title"] = "Historial de Auditoría";
}

<div class="text-center mb-4">
    <h1>Historial de Auditoría</h1>
</div>

<div class="d-flex justify-content-center mb-4">
    <button id="loadAuditoria" class="btn btn-secondary me-2">Cargar Auditoría</button>
</div>

<div id="dataTableContainer" style="display: none;">
    <!-- Aquí se cargará la vista parcial de la tabla -->
</div>

@section Scripts {

    <script>
        $(document).ready(function () {
            // Configuración del lenguaje en español para DataTables
            var LenguajeEs = {
                "lengthMenu": "Mostrar _MENU_ registros",
                "emptyTable": "No hay datos disponibles en la tabla",
                "info": "Mostrando _START_ a _END_ de _TOTAL_ registros",
                "infoEmpty": "Mostrando 0 a 0 de 0 registros",
                "infoFiltered": "(filtrado de _MAX_ registros totales)",
                "search": "Buscar:",
                "zeroRecords": "No se encontraron registros coincidentes",
                "paginate": {
                    "first": "Primero",
                    "last": "Último",
                    "next": "Siguiente",
                    "previous": "Anterior"
                },
                "loadingRecords": "Cargando...",
                "processing": "Procesando...",
                "aria": {
                    "sortAscending": ": activar para ordenar columna ascendente",
                    "sortDescending": ": activar para ordenar columna descendente"
                }
            };

            function cargarTablaAuditoria() {
                $.ajax({
                    url: '@Url.Action("CargarAuditoria", "TbAuditorias")',
                    type: 'GET',
                    success: function (data) {
                        $('#dataTableContainer').html(data);
                        $('#dataTableContainer').fadeIn();

                        // Destruir cualquier DataTable anterior para evitar conflictos
                        if ($.fn.DataTable.isDataTable('#auditoriaTable')) {
                            $('#auditoriaTable').DataTable().destroy();
                        }

                        // Inicializar DataTable con configuración en español
                        $('#auditoriaTable').DataTable({
                            language: LenguajeEs,
                            responsive: true,
                            dom: '<"top"lf>rt<"bottom"ip><"clear">',
                            pageLength: 10,
                            lengthMenu: [5, 10, 25, 50, 100]
                        });
                    },
                    error: function (xhr, status, error) {
                        console.error("Error al cargar auditoría: " + error);
                    }
                });
            }

            $('#loadAuditoria').on('click', function () {
                console.log('Cargando auditoría...');
                cargarTablaAuditoria();
            });
        });
    </script>

}
