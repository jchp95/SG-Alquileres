@model Alquileres.Models.DetallesCobroViewModel

<div class="container-fluid px-0">
    <!-- Tabla principal modificada para DataTable -->
    <div class="table-responsive">
        <table id="reciboTable" class="table table-bordered display nowrap" style="width:100%">
            <thead class="bg-light"> <!-- Ocultamos el thead ya que no es compatible con nuestra estructura -->
                <tr>
                    <th>Recibo de Pago</th>
                    <td>
                        #@Model.Cobro.FidCobro - Emitido el @Model.Cobro.Ffecha.ToString("dd/MM/yyyy") a las
                        @Model.Cobro.Fhora.ToString("hh:mm tt") - @Model.Cobro.Fmonto.ToString("C")
                    </td>
                </tr>
                <tr>
                    <th>Detalle</th>
                    <th>Información</th>
                </tr>
            </thead>
            <tbody>
                <!-- Información del pago -->
                <tr class="table-info">
                    <th colspan="2" class="bg-light">
                        <i class="fas fa-info-circle me-2"></i>Información del pago
                    </th>
                </tr>
                <tr>
                    <th>Concepto</th>
                    <td>@Model.Cobro.Fconcepto</td>
                </tr>

                <!-- Desglose del monto -->
                <tr class="table-info">
                    <th colspan="2" class="bg-light">
                        <i class="fas fa-calculator me-2"></i>Desglose del monto
                    </th>
                </tr>
                <tr>
                    <th>Monto original</th>
                    <td>@Model.Cobro.Fmonto.ToString("C")</td>
                </tr>
                <tr>
                    <th>Descuento aplicado</th>
                    <td class="text-danger">
                        <i class="fas fa-minus-circle me-1"></i>
                        @Model.Cobro.Fdescuento.ToString("C")
                    </td>
                </tr>
                <tr>
                    <th>Cargos adicionales</th>
                    <td class="text-success">
                        <i class="fas fa-plus-circle me-1"></i>
                        @Model.Cobro.Fcargos.ToString("C")
                    </td>
                </tr>
                <tr class="bg-light">
                    <th class="fw-bold">Total pagado</th>
                    <td class="fw-bold text-primary">
                        @((Model.Cobro.Fmonto + Model.Cobro.Fcargos - Model.Cobro.Fdescuento).ToString("C"))
                    </td>
                </tr>

                <!-- Métodos de Pago -->
                <tr class="table-info">
                    <th colspan="2" class="bg-light">
                        <i class="fas fa-credit-card me-2"></i>Métodos de Pago
                    </th>
                </tr>
                @if (Model.Desglose != null)
                {
                    <tr>
                        <th>Efectivo</th>
                        <td>@Model.Desglose.Fefectivo.ToString("C")</td>
                    </tr>
                    <tr>
                        <th>Transferencia</th>
                        <td>@Model.Desglose.Ftransferencia.ToString("C")</td>
                    </tr>
                    <tr>
                        <th>Tarjeta</th>
                        <td>@Model.Desglose.Ftarjeta.ToString("C")</td>
                    </tr>
                    <tr>
                        <th>Cheque</th>
                        <td>@Model.Desglose.Fcheque.ToString("C")</td>
                    </tr>
                    <tr>
                        <th>Depósito</th>
                        <td>@Model.Desglose.Fdeposito.ToString("C")</td>
                    </tr>
                    <tr>
                        <th>Nota Crédito (@Model.Desglose.FnoNotaCredito)</th>
                        <td>@Model.Desglose.FnotaCredito.ToString("C")</td>
                    </tr>
                    <tr>
                        <th>Débito automático</th>
                        <td>@Model.Desglose.FdebitoAutomatico.ToString("C")</td>
                    </tr>
                    <tr class="bg-light">
                        <th class="fw-bold">Total pagado</th>
                        <td class="fw-bold text-primary">
                            @Model.TotalPagos.ToString("C")
                        </td>
                    </tr>
                }
                else
                {
                    <tr>
                        <td colspan="2" class="text-center text-muted">No hay desglose de pagos</td>
                    </tr>
                }

                <!-- Información del Inquilino -->
                <tr class="table-info">
                    <th colspan="2" class="bg-light">
                        <i class="fas fa-user-tie me-2"></i>Información del Inquilino
                    </th>
                </tr>
                @if (Model.Inquilino != null)
                {
                    <tr>
                        <th>Nombre completo</th>
                        <td>@Model.Inquilino.Fnombre @Model.Inquilino.Fapellidos</td>
                    </tr>
                    <tr>
                        <th>Cédula</th>
                        <td>@Model.Inquilino.Fcedula</td>
                    </tr>
                    <tr>
                        <th>Dirección</th>
                        <td>@Model.Inquilino.Fdireccion</td>
                    </tr>
                    <tr>
                        <th>Teléfono</th>
                        <td class="telefono-display">@Model.Inquilino.Ftelefono</td>
                    </tr>
                    <tr>
                        <th>Celular</th>
                        <td class="telefono-display">@Model.Inquilino.Fcelular</td>
                    </tr>
                }
                else
                {
                    <tr>
                        <td colspan="2" class="text-center text-muted">Información no disponible</td>
                    </tr>
                }

                <!-- Información del Inmueble -->
                <tr class="table-info">
                    <th colspan="2" class="bg-light">
                        <i class="fas fa-home me-2"></i>Información del Inmueble
                    </th>
                </tr>
                @if (Model.Inmueble != null)
                {
                    <tr>
                        <th>Descripción</th>
                        <td>@Model.Inmueble.Fdescripcion</td>
                    </tr>
                    <tr>
                        <th>Dirección</th>
                        <td>@Model.Inmueble.Fdireccion</td>
                    </tr>
                    <tr>
                        <th>Ubicación</th>
                        <td>@Model.Inmueble.Fubicacion</td>
                    </tr>
                    <tr>
                        <th>Precio</th>
                        <td class="fw-bold text-primary">@Model.Inmueble.Fprecio.ToString("C")</td>
                    </tr>
                }
                else
                {
                    <tr>
                        <td colspan="2" class="text-center text-muted">Información no disponible</td>
                    </tr>
                }

                <!-- Cuotas Pagadas -->
                <tr class="table-info">
                    <th colspan="2" class="bg-light">
                        <i class="fas fa-list-check me-2"></i>Cuotas Pagadas
                    </th>
                </tr>
                @if (Model.Detalles != null && Model.Detalles.Any())
                {
                    <!-- Listado de cuotas en formato de dos columnas -->
                    @foreach (var detalle in Model.Detalles)
                    {
                        var cuota = Model.Cuotas?.FirstOrDefault(c => c.FNumeroCuota == detalle.FnumeroCuota);

                        <!-- Encabezado de la cuota -->
                        <tr>
                            <th>No. Cuota </th>
                            <td>@detalle.FnumeroCuota</td> <!-- Celda vacía para mantener la estructura -->
                        </tr>

                        <!-- Detalles de la cuota -->
                        <tr>
                            <th class="ps-4 text-muted">Monto</th>
                            <td>@detalle.Fmonto.ToString("0.00")</td>
                        </tr>
                        <tr>
                            <th class="ps-4 text-muted">Saldo</th>
                            <td class="@(cuota?.Fsaldo > 0 ? "text-warning" : "text-success")">
                                @(cuota?.Fsaldo.ToString("0.00") ?? "N/A")
                            </td>
                        </tr>
                        <tr>
                            <th class="ps-4 text-muted">Mora</th>
                            <td>@detalle.Fmora.ToString("0.00")</td>
                        </tr>
                        <tr>
                            <th class="ps-4 text-muted">Vencimiento</th>
                            <td>@(cuota?.Fvence.ToString("dd/MM/yy") ?? "N/A")</td>
                        </tr>
                        <tr>
                            <th class="ps-4 text-muted">Estado</th>
                            <td>
                                @if (cuota != null)
                                {
                                    <span
                                        class="badge @(cuota.Fstatus == 'S' ? "bg-success" : cuota.Fstatus == 'N' ? "bg-warning" : "bg-secondary") rounded-pill px-2 py-1">
                                        @(cuota.Fstatus == 'S' ? "Pagado" : cuota.Fstatus == 'N' ? "Pendiente" : "Desconocido")
                                    </span>
                                }
                            </td>
                        </tr>
                    }

                    <!-- Totales de cuotas -->
                    <tr class="bg-light">
                        <th class="fw-bold">Total Monto</th>
                        <td class="fw-bold">@Model.Detalles.Sum(d => d.Fmonto).ToString("C")</td>
                    </tr>
                    <tr class="bg-light">
                        <th class="fw-bold">Saldo Pendiente</th>
                        <td class="fw-bold">@(Model.Cuotas?.Sum(c => c.Fsaldo).ToString("C") ?? "N/A")</td>
                    </tr>
                }
                else
                {
                    <tr>
                        <th>Cuotas pagadas</th>
                        <td class="text-muted">No se encontraron cuotas pagadas</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
    <div class="form-group-button mt-2">
        <a asp-action="Index" class="btn btn-secondary">Volver a la Lista</a>
    </div>

</div>